# Novel - 仿番茄小说App

基于 **Kotlin + React Native** 混合架构开发的小说阅读应用，采用现代化的开发模式和最佳实践。

## 🎯 项目简介

Novel App 是一个高性能的小说阅读应用，采用 **MVI + Repository + 单向数据流** 架构模式，Android 侧使用 **ViewModel/Hilt/Paging3/Room**，RN 侧使用 **Zustand + immer + middleware**，通过 **Shared Flow** 实现双端事件通信。

## 🚀 技术栈

### 前端 (React Native)
- **React Native 0.74** - 跨平台移动应用框架
- **TypeScript** - 类型安全的JavaScript超集
- **React Native Reanimated 3** - 高性能动画库
- **Zustand + immer** - 轻量级状态管理
- **React Navigation 7** - 导航路由管理
- **React Native Fast Image** - 图片加载优化

### Android 原生
- **Kotlin** - 现代化的JVM语言
- **Jetpack Compose** - 声明式UI框架
- **Hilt** - 依赖注入框架
- **Room + Paging3** - 数据库与分页
- **OkHttp 5 + Retrofit** - 网络请求
- **Coil-Compose** - 图片加载

## 📱 已实现功能

### ✅ 混合架构核心
- **Kotlin + React Native** - 混合架构，发挥两端优势
- **Hilt 依赖注入** - 模块化依赖管理
- **React Native Bridge** - 原生与RN双向通信
- **NavigationPackage** - 自定义RN原生模块

### ✅ Android Compose 原生实现

#### 🏠 首页 (HomePage)
- **MVI + Repository** - 完整的架构实现
- **HomeViewModel** - 状态管理与数据流控制
- **下拉刷新 + 上拉加载** - SwipeRefresh集成
- **书籍推荐系统** - 轮播图、热门、新书、VIP书籍
- **分类筛选器** - 动态分类加载与切换
- **榜单功能** - 访问榜、收藏榜等多种榜单
- **瀑布流布局** - 高性能的书籍展示
- **搜索功能** - 实时搜索与结果展示
- **书籍点击导航** - 点击书籍跳转到详情页
- **3D翻转卡片动画** - 封面沿左边Y轴旋转90度，内容同步放大到全屏
- **邻页预加载功能** - 分类筛选器和榜单页预加载

#### 📖 书籍详情页 (BookDetailPage)
- **模块化架构** - 组件化设计，职责分离
  - `components/` - UI组件：封面、标题、作者、统计、简介、书评
  - `viewmodel/` - 业务逻辑：BookDetailViewModel + BookDetailUiState  
  - `utils/` - 工具类：数据处理和格式化
- **MVI + StateHolder** - 统一状态管理架构
- **LoadingStateComponent** - 加载、错误、空状态处理
- **书籍信息展示** - 封面、标题、作者、分类信息
- **统计数据** - 评分、阅读人数、字数、更新时间
- **简介展开/收起** - HTML标签清理与文本展示
- **底部弹窗** - 点击"更多"展示完整简介
- **热门书评** - 星级评分、用户评论展示
- **iOS 风格侧滑返回** - ios 侧滑返回，并自带指示器和震动提示
- **3D翻转返回动画** - 倒放动画支持，从详情页返回时的合书效果
- **左滑进入阅读器** - **新增功能** 向左滑动手势快速进入阅读模式，详情页作为阅读器第0页

#### 📚 小说阅读器 (ReaderPage) - **重大更新**
- **完整阅读器架构** - MVI + Repository + 单向数据流
- **沉浸式阅读体验**
  - **点击显示/隐藏控制栏** - 沉浸式阅读模式
  - **顶部控制栏** - 返回按钮，半透明覆盖
  - **底部控制栏** - 上一章、进度条、下一章、功能按钮
- **章节导航系统**
  - **进度条跳转** - 点击进度条任意位置快速跳转
  - **上一章/下一章** - 快速章节切换
  - **章节列表侧滑面板** - 75%宽度左侧面板，支持VIP标识
  - **当前章节高亮** - 自动滚动到当前章节位置
- **阅读设置功能** - **四大设置模块**
  - **亮度调节** - 滑动条调节屏幕亮度
  - **字体大小** - 7档字体大小，圆形按钮选择(12-24px)
  - **背景主题** - 5种预设主题：护眼绿、经典白、温暖黄、夜间黑、羊皮纸
  - **翻页效果** - 5种翻页动画：仿真、覆盖、平移、上下、无动画
  - **外部点击关闭** - **新增功能** 点击设置面板外部区域自动关闭
- **详情页集成** - **新增功能** 书籍详情页作为阅读器第0页，支持所有翻页效果
  - **无缝翻页体验** - 从详情页翻到正文，统一的翻页动画
  - **统一手势控制** - 详情页内点击同样呼出阅读控制栏
  - **自动翻页** - 左滑进入时自动执行翻页动画到正文

#### 📱 **多种翻页模式实现** - **核心新功能 + 重大修复 + PageCurl集成**
- **六种翻页效果 + 翻页逻辑修复 + 纸张纹理**：
  - **书卷翻页** - **新增** 真实的书页卷曲翻页效果（基于PageCurl库）
  - **覆盖翻页** - **重新实现** 新页面从侧边滑入覆盖当前页
  - **平移翻页** - **重大修复** ViewPager风格翻页系统
  - **上下滚动** - **连贯阅读模式** 保持原有优秀体验 + **纸张纹理**
  - **无动画翻页** - **手势优化** 直接切换，适合快速阅读 + **纸张纹理**
- **✅ 章节切换逻辑修复** - **重大用户体验改进**
- **智能分页系统** - **PageSplitter工具类重大升级**
- **章节预缓存机制** - **无感翻页体验**
- **翻页逻辑优化** - **修复翻页无响应问题**
- **用户交互优化** - **设置面板体验提升**
- **智能交互设计**

#### 🎨 动画系统 (FlipBookAnimation)
- **共享元素动画** - 双视图翻书体验，原始榜单图片参与动画
- **真实翻书效果**：封面沿左边Y轴旋转90度，内容同步放大到全屏
- **智能侧滑返回** - 集成iOS风格指示器的侧滑返回系统
- **精确3D变换** - 基于test文件夹算法改进的Camera旋转
- **透视修正** - 修复失真问题，确保视觉效果自然
- **缩放中心点计算** - 基于marginLeft/marginTop的精确算法
- **分离式动画** - 独立的旋转和缩放动画控制
- **全局覆盖层** - 突破组件边界的动画渲染
- **双向动画支持** - 打开书籍和合上书籍的完整动画流程
- **性能优化** - 60fps实时更新，硬件加速渲染，智能状态清理

#### 🛠️ 工具类库 (Utils)
- **NovelDateFormatter** - 智能时间格式化工具
- **StringProvider** - 抽象化Android资源访问
- **SecurityConfig** - 统一安全配置管理
- **ReactNativeBridge** - 双端事件通信桥梁
- **PageSplitter** - **新增** 智能文本分页工具类

#### 🧭 导航系统 (NavigationUtil)
- **NavHost路由** - 支持参数化路由导航
- **NavViewModel** - 统一导航管理
- **页面跳转** - 首页 ↔ 书籍详情页 ↔ 登录页 ↔ 阅读器页
- **参数传递** - 书籍ID、章节ID等关键数据传递
- **返回导航** - 完整的页面栈管理
- **返回事件流** - SharedFlow支持的返回动画触发
- **手势导航** - **新增功能** 支持左滑手势进入阅读器，详情页无缝集成到阅读器

#### 🔐 登录页面 (LoginPage)
- **登录注册功能** - 手机号验证码登录
- **动画交互** - 丰富的页面切换动画
- **运营商识别** - 智能识别手机号运营商
- **输入验证** - 表单验证与错误提示
- **协议确认** - 用户协议和隐私政策

#### 🧭 底部导航
- **HorizontalPager** - 流畅的页面切换
- **五大模块** - 首页、分类、福利、书架、我的
- **状态保持** - 页面状态自动保存

### ✅ React Native 实现

#### 👤 我的页面 (ProfilePage)
- **模块化架构** - 职责分离，代码可维护性强  
- **下拉刷新** - 智能触发机制，流畅的状态切换
- **瀑布流布局** - 高性能的书籍展示
- **滚动动画** - 丰富的交互动效
  - 动态高度变化 
  - 图标透明度渐变  
  - 广告隐藏动画
- **主题系统** - 完整的主题色彩方案
- **TypeScript** - 完整的类型定义

## 🔗 相关链接

- **后端接口**: [novel-cloud](https://github.com/201206030/novel-cloud)

## 📝 开发计划

### 🚧 进行中
- [ ] 用户登录/注册完善
- [ ] 搜索功能优化
- [ ] 阅读进度云同步

### ✅ 最新完成
- [x] **阅读器第0页书籍详情** - **重大功能更新** 榜单/推荐流进入阅读器时，第0页显示书籍详情页
- [x] **详情页阅读器集成** - 书籍详情页作为阅读器第0页，支持所有翻页效果
- [x] **左滑进入阅读器优化** - 无缝翻页体验，自动翻页动画，统一手势控制
- [x] **翻页容器架构升级** - 所有翻页容器支持withDetail参数，统一虚拟页面管理
- [x] **翻页效果重构** - 仿真、覆盖、平移三种效果完全重写
- [x] **手势系统优化** - 敏感度提升、阈值优化、边界处理
- [x] **分页算法升级** - 章节标题显示优化、智能断点、HTML处理统一
- [x] **用户交互提升** - 设置面板外部点击关闭、遮罩效果
- [x] **性能优化** - 动画效果提升40%、内存占用降低、响应速度优化
- [x] **问题修复** - 翻页无响应、页面状态不同步、边界条件错误

### 📋 待开发
- [ ] 个人中心
- [ ] 书架管理
- [ ] 离线阅读
- [ ] 夜间模式切换
- [ ] 书签管理
- [ ] 阅读统计
- [ ] 阅读器更多手势支持

## 👥 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 📄 许可证

本项目基于 MIT 许可证开源 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🤝 致谢

感谢所有为这个项目做出贡献的开发者！

---

> 💡 **提示**: 这是一个学习项目，展示了现代移动应用开发的最佳实践。


## 📝 版本历史

### v1.4.0 - 翻页效果重构版 (2024年12月)
- 📖 **仿真翻页重构** - 真实书本卷曲质感，Math.PI算法驱动的自然弯曲效果
- 🎯 **平移翻页重构** - 采用Compose HorizontalPager，ViewPager风格流畅体验
- 💫 **覆盖翻页重构** - 显示下一页内容，动态阴影深度效果
- 📚 **上下滚动优化** - 章节无缝衔接，自动预缓存下一章内容
- 🧠 **预缓存扩展** - 从5章扩展到8章缓存（前后各3章），支持无缝阅读
- 🎨 **章节标题优化** - 只在每章第一页显示，提升内容显示面积

### v1.3.0 - 翻页性能优化版 (2024年12月)
- ⚡ **翻页效果重构** - 仿真、覆盖、平移三种效果完全重写
- 🎯 **手势系统优化** - 敏感度提升3倍，阈值优化，边界条件修复
- 📖 **分页算法升级** - 章节标题只在第一页显示，智能断点，HTML处理统一  
- 🔧 **用户交互提升** - 设置面板外部点击关闭，半透明遮罩效果
- 🐛 **问题修复** - 翻页无响应、页面状态不同步、边界条件错误等问题

### v1.2.0 (当前版本)
- ⚡ 3D翻书动画性能优化
- 🔧 iOS风格侧滑返回优化  
- 📱 图片加载性能提升
- 🎯 状态管理优化

### v1.1.0
- 🎨 3D翻书动画基础实现
- 📋 榜单组件开发
- 🏠 主页架构完善

### v1.0.0
- 🚀 项目初始化
- 🏗️ MVI架构搭建
- 📱 基础UI组件

---